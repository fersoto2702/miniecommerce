<div class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 animate-fadeIn" (click)="closeOnBackdrop($event)" (keydown.escape)="close.emit()">
  
  <div class="bg-white dark:bg-gray-800 rounded-3xl shadow-2xl w-[90%] max-w-[420px] relative overflow-hidden animate-scaleIn">
    
    <!-- Pok√©ball decorativa de fondo -->
    <div class="absolute top-[-50px] right-[-50px] w-[200px] h-[200px] opacity-5 pointer-events-none">
      <div class="absolute w-full h-1/2 bg-red-500 rounded-t-full"></div>
      <div class="absolute w-full h-1/2 bg-white rounded-b-full bottom-0"></div>
    </div>

    <!-- Header con gradiente Pok√©mon -->
    <div class="bg-gradient-to-br from-red-500 to-yellow-400 p-6 relative">
      <button 
        class="absolute top-3 right-3 bg-white/30 hover:bg-white/50 w-9 h-9 rounded-full flex items-center justify-center text-white font-bold text-xl transition-all hover:rotate-90"
        (click)="close.emit()">
        ‚úï
      </button>
      <h2 class="text-white text-xl font-bold drop-shadow-md">
        ‚ö° A√±adir al Carrito
      </h2>
    </div>

    <!-- Contenido -->
    <div class="p-6">
      
      <!-- Imagen del producto -->
      <img 
        [src]="product.image || 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/25.png'" 
        [alt]="product.name"
        class="w-full h-[200px] object-contain mb-4 drop-shadow-lg">

      <!-- Nombre del producto -->
      <h3 class="text-[22px] font-bold text-gray-900 dark:text-white mb-3 text-center">
        ¬øCu√°ntas unidades de <span class="text-red-500">{{ product.name }}</span>?
      </h3>

      <!-- Indicador de stock -->
      <div class="text-center mb-6">
        <span 
          class="inline-flex items-center gap-1.5 px-3.5 py-1.5 rounded-full text-[13px] font-semibold shadow-lg"
          [class.bg-gradient-to-r]="true"
          [class.from-blue-500]="product.stock > 5"
          [class.to-blue-400]="product.stock > 5"
          [class.from-red-500]="product.stock <= 5"
          [class.to-red-400]="product.stock <= 5"
          [class.animate-pulse]="product.stock <= 5"
          class="text-white">
          üì¶ Quedan <span>{{ product.stock }}</span> unidades
        </span>
      </div>

      <!-- Controles de cantidad -->
      <div class="flex items-center justify-center gap-5 mb-5">
        <button 
          class="bg-gradient-to-br from-red-500 to-red-400 text-white w-14 h-14 rounded-full text-3xl font-bold shadow-lg hover:scale-110 active:scale-95 transition-all disabled:from-gray-400 disabled:to-gray-300 disabled:opacity-50 disabled:cursor-not-allowed"
          (click)="remove()"
          [disabled]="qty <= 1">
          ‚àí
        </button>
        
        <input 
          type="number" 
          [(ngModel)]="qty"
          (ngModelChange)="validateQty()"
          (keydown.enter)="accept()"
          [min]="1"
          [max]="product.stock"
          class="w-20 h-14 text-center text-[32px] font-bold border-3 border-yellow-400 rounded-2xl bg-yellow-50 dark:bg-yellow-900/20 text-gray-900 dark:text-white focus:outline-none focus:border-red-500 focus:ring-4 focus:ring-red-500/10 transition-all">
        
        <button 
          class="bg-gradient-to-br from-red-500 to-red-400 text-white w-14 h-14 rounded-full text-3xl font-bold shadow-lg hover:scale-110 active:scale-95 transition-all disabled:from-gray-400 disabled:to-gray-300 disabled:opacity-50 disabled:cursor-not-allowed"
          (click)="add()"
          [disabled]="qty >= product.stock">
          +
        </button>
      </div>

      <!-- Mensaje de l√≠mite -->
      <div 
        class="text-center text-red-500 text-[13px] font-semibold -mt-2.5 mb-4 transition-opacity"
        [class.opacity-0]="!showLimitMessage"
        [class.opacity-100]="showLimitMessage">
        ‚ö†Ô∏è Stock m√°ximo alcanzado: {{ product.stock }} unidades
      </div>

      <!-- Informaci√≥n de precios -->
      <div class="bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 p-4 rounded-2xl mb-5">
        <div class="text-sm text-slate-600 dark:text-slate-400 mb-2 flex items-center gap-1.5">
          üí∞ Precio unitario: ${{ product.price }}
        </div>
        <div class="text-[28px] font-bold text-blue-900 dark:text-blue-300 flex items-center gap-2">
          üî• Total: ${{ product.price * qty }}
        </div>
      </div>

      <!-- Botones de acci√≥n -->
      <div class="flex gap-3">
        <button 
          class="flex-1 px-4 py-3.5 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl font-bold hover:bg-gray-200 dark:hover:bg-gray-600 transition-all"
          (click)="close.emit()">
          Cancelar
        </button>
        <button 
          class="flex-1 px-4 py-3.5 bg-gradient-to-br from-blue-600 to-blue-500 text-white rounded-xl font-bold shadow-lg hover:-translate-y-0.5 hover:shadow-xl active:translate-y-0 transition-all disabled:opacity-70 disabled:cursor-not-allowed flex items-center justify-center gap-2"
          (click)="accept()"
          [disabled]="isLoading"
          [class.opacity-70]="isLoading">
          <span *ngIf="!isLoading">‚ö° A√±adir</span>
          <span *ngIf="isLoading">‚è≥ A√±adiendo...</span>
        </button>
      </div>

    </div>
  </div>
</div>

<!-- Mensaje de √©xito (fuera del modal) -->
<div 
  *ngIf="showSuccess"
  class="fixed top-6 right-6 bg-gradient-to-br from-green-500 to-green-400 text-white px-6 py-4 rounded-xl shadow-2xl flex items-center gap-3 font-semibold z-[100] animate-slideInRight">
  <div class="w-6 h-6 bg-white rounded-full flex items-center justify-center text-green-500 text-lg animate-scaleIn">
    ‚úì
  </div>
  <span>¬°{{ qty }} {{ qty === 1 ? 'unidad a√±adida' : 'unidades a√±adidas' }} al carrito!</span>
</div>

<style>
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes scaleIn {
  from {
    opacity: 0;
    transform: scale(0.8);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

@keyframes slideInRight {
  from {
    transform: translateX(400px);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

.animate-fadeIn {
  animation: fadeIn 0.3s ease;
}

.animate-scaleIn {
  animation: scaleIn 0.3s ease;
}

.animate-slideInRight {
  animation: slideInRight 0.4s ease;
}
</style>